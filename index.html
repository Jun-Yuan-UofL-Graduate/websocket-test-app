<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SocketIO Client</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>

    <!-- File input and image output -->

    <h1>Welcome to the Restaurant</h1>
    <p>Who Are You?</p>

    <input type="button" id="server" value="I am a Server">
    <!--<input type="button" id="kitchen" value="I am a Chef">-->

      <button id="kitchen">I am a Chef</button>



    <p id="deskMessage">This message is for desktop</p>

    <p id="mobMessage">This message is only for mobile users</p>

    <input type="file" id="input">
    <img src="" id="output">

    <!-- Client Code -->
    <script type="text/javascript">

// var elements = document.getElementById("deskMessage");
//             elements.style.display = 'show';
// var elements = document.getElementById("mobMessage");
//             elements.style.display = 'none';

let device = '';

    if (navigator.userAgent.match(/Android/i)
        || navigator.userAgent.match(/webOS/i)
        || navigator.userAgent.match(/Windows Phone/i)) {
        device = true;
    } else {
        device = false;
    }
    console.log(device);

    if(device == true){
      var elements = document.getElementById("deskMessage");
            elements.style.display = 'none';
    }else{
var elements = document.getElementById("mobMessage");
            elements.style.display = 'none';
    }
        var agent = navigator.userAgent;
        var isWebkit = (agent.indexOf("AppleWebKit") > 0);
        var isAndroid = (agent.indexOf("Android") > 0);
        var isWebOS = (agent.indexOf("webOS") > 0);
        var isWindowsMobile = (agent.indexOf("IEMobile") > 0);
        var isSmallScreen = (screen.width < 767 || (isAndroid && screen.width < 1000));
        var isUnknownMobile = (isWebkit && isSmallScreen);
        var isMobile = (isAndroid || isWebOS || isWindowsMobile || isUnknownMobile);

        var elements = document.getElementById("mobMessage");
        elements.style.display = 'none';
        if (isMobile && isSmallScreen && document.cookie.indexOf("mobileFullSiteClicked=") < 0) {
            //mobileRedirect();

            //console.log("This is a computer");
            var elements = document.getElementById("mobMessage");
            elements.style.display = 'show';
        } 
        //} else {
        //    var elements = document.getElementById("mobMessage");
        //    elements.style.display = 'none';
        //}


        //const express = require("express");
        //const socketIO = require("socket.io");
        //const path = require("path");
        //const PORT = process.env.PORT || 3000;
        ////const INDEX = path.join(__dirname, 'index.html');
        //const CHEFPATH = path.join(__dirname, 'chefPage.html');

        //const server = express()
        //    .use((req, res) => res.sendFile(INDEX))
        //    .listen(PORT, () => console.log("Listening on localhost" + PORT));

        //const io = socketIO(server);


        let goToServer = document.querySelector("#kitchen");

        goToServer.addEventListener("click", goToChef)

        
        function goToChef() {
            //document.location = "chefPage.html"

            io.on("connection", function (socket) {
                socket.on("join", function (room) {
                    socket.join(room)
                    socket.on("image", function (msg) {
                        socket.broadcast.to(room).emit("image", msg);
                    });
                })
            });
        }


      // Get WebSocket
      var socket = io("https://websocket-test-app.onrender.com");

      // Get DOM elements
      var input = document.getElementById("input");
      var output = document.getElementById("output");

      // Join a channel
      var room = "test";
      socket.emit("join", room);

      // Listen to file input events
      document.getElementById("input").addEventListener("change", function (event) {

        // Prepeare file reader
        var file = event.target.files[0];
        var fileReader = new FileReader();

        fileReader.onloadend = function (event) {
          // Send an image event to the socket
          var image = event.target.result
          output.src = image;
          socket.emit("image", image);
        };

        // Read file
        fileReader.readAsDataURL(file);
      })

      socket.on("image", function (image) {
        output.src = image;
      });
    </script>
  </body>
</html>